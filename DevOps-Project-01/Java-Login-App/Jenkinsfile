pipeline {
    agent any
    stages {
        stage('1. Maven Build') {
            steps {
                dir('DevOps-Project-01/Java-Login-App') {
                    sh '''
                    /opt/homebrew/bin/mvn clean package -DskipTests
                    ls -la target/
                    '''
                }
            }
        }
        stage('2. Docker Build - NO CREDS') {
            steps {
                dir('DevOps-Project-01/Java-Login-App') {
                    sh '''
                    # Skip credential helper entirely
                    DOCKER_BUILDKIT=0 /usr/local/bin/docker build --no-cache -t digdigdigdig/java-login-app:test .
                    /usr/local/bin/docker images | head -5
                    '''
                }
            }
        }
        stage('3. Test Container') {
            steps {
                dir('DevOps-Project-01/Java-Login-App') {
                    sh '''
                    /usr/local/bin/docker run --rm -p 8081:8080 digdigdigdig/java-login-app:test sleep 5
                    echo "Container test PASSED"
                    '''
                }
            }
        }
    }
}
