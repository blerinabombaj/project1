pipeline {
    agent any
    stages {
        stage('1. Build Java App') {
            steps {
                dir('DevOps-Project-01/Java-Login-App') {
                    sh '''
                    pwd
                    ls -la
                    mvn clean package -DskipTests || echo "Maven not found, skipping"
                    '''
                }
            }
        }
        stage('2. Docker Build') {
            steps {
                dir('DevOps-Project-01/Java-Login-App') {
                    sh '''
                    pwd
                    ls -la
                    docker build -t digdigdigdig/java-login-app:test .
                    '''
                }
            }
        }
        stage('3. Deploy K8s') {
            steps {
                dir('DevOps-Project-01/Java-Login-App/k8s') {
                    sh '''
                    pwd
                    ls -la
                    kubectl apply -f . --dry-run=client
                    '''
                }
            }
        }
    }
}
